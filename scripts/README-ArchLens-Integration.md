# ArchLens Integration –¥–ª—è Claude Code

## üîç –û–±–∑–æ—Ä

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è ArchLens —Å Claude Code –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞ –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Ñ–∞–π–ª–æ–≤.

## üìÅ –§–∞–π–ª—ã

### `archilens-auto-analysis.ps1`
–û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç-hook –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Ñ–∞–π–ª–æ–≤.

**–§—É–Ω–∫—Ü–∏–∏:**
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–Ω–æ–≥–æ crate –ø–æ –ø—É—Ç–∏ —Ñ–∞–π–ª–∞
- –ê–Ω–∞–ª–∏–∑ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤ –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–∞—Ö
- –¶–≤–µ—Ç–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–∫–∞–º–∏
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –¥–∞–ª—å–Ω–µ–π—à–∏–º –¥–µ–π—Å—Ç–≤–∏—è–º

### `archilens-integration.ps1`
–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –≥–ª—É–±–æ–∫–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å ArchLens.

**–§—É–Ω–∫—Ü–∏–∏:**
- –ë–∞–∑–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–µ–∫—Ç–∞ (`analyze`)
- –ü–æ–∏—Å–∫ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º (`critical`)
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤ (`report`)
- –ú–µ—Ç—Ä–∏–∫–∏ —Ä–∞–∑–º–µ—Ä–∞ –∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Hooks

–í —Ñ–∞–π–ª–µ `.claude/settings.local.json` –¥–æ–±–∞–≤–ª–µ–Ω—ã hooks:

```json
{
  "hooks": {
    "post-edit": "script for single file analysis",
    "post-multi-edit": "script for full analysis",
    "pre-commit": "pre-commit analysis notification"
  }
}
```

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–µ
Hooks —Å—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏:
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –ª—é–±–æ–≥–æ `.rs` —Ñ–∞–π–ª–∞ (`post-edit`)
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ (`post-multi-edit`)
- –ü–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º (`pre-commit`)

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

#### –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ñ–∞–π–ª–∞:
```powershell
.\scripts\archilens-auto-analysis.ps1 -EditedFile "crates\memory\src\service.rs"
```

#### –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑:
```powershell
.\scripts\archilens-auto-analysis.ps1 -FullAnalysis
```

#### –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑:
```powershell
.\scripts\archilens-integration.ps1 -Action analyze
.\scripts\archilens-integration.ps1 -Action critical
.\scripts\archilens-integration.ps1 -Action report
```

## üéØ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –¥–ª—è MAGRAY CLI

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
Hook –æ—Å–æ–±–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤:
- `crates\memory\src\*` - —Å–∏—Å—Ç–µ–º–∞ –ø–∞–º—è—Ç–∏
- `crates\ai\src\*` - AI/embedding —Å–µ—Ä–≤–∏—Å—ã
- `crates\llm\src\*` - LLM –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- `crates\cli\src\*` - CLI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞
- **–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞**: –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ >100KB
- **–°–ª–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–∞**: –û—Ü–µ–Ω–∫–∞ –ø–æ –æ–±—â–µ–º—É —Ä–∞–∑–º–µ—Ä—É
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã**: –ü–æ–∏—Å–∫ –∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
Hook –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
- –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
- –ü–æ–ª–Ω—ã–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ —á–µ—Ä–µ–∑ ArchLens

## üìä –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞

```
[2025-08-04 21:19:23] Info: Starting ArchLens automatic analysis...
[2025-08-04 21:19:23] Info: Analyzing changes in file: crates\memory\src\service.rs
[2025-08-04 21:19:23] Info: Detected crate: memory
[2025-08-04 21:19:23] Info: Getting project structure...
[2025-08-04 21:19:23] Info: File size: 54.93 KB
[2025-08-04 21:19:23] Success: Automatic analysis completed
[2025-08-04 21:19:23] Info: For detailed analysis run: archlens export_ai_compact
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- PowerShell 5.1+
- ArchLens MCP Server –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –≤ Claude Code
- –ü—Ä–æ–µ–∫—Ç MAGRAY CLI –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ

### –†–∞–∑—Ä–µ—à–µ–Ω–∏—è PowerShell
–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –ø—Ä–æ–±–ª–µ–º—ã —Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:
```powershell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

## üé® –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞ –ª–æ–≥–æ–≤

- **Cyan** - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- **Green** - –£—Å–ø–µ—à–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
- **Yellow** - –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
- **Red** - –û—à–∏–±–∫–∏

## üìà –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ArchLens MCP

Hook –≥–æ—Ç–æ–≤ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å ArchLens —á–µ—Ä–µ–∑ MCP API:
- `mcp__archlens__analyze_project` - –±–∞–∑–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑
- `mcp__archlens__export_ai_compact` - –ø–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç
- `mcp__archlens__get_project_structure` - —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

## üîÑ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∞**: –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –≤—ã–∑–æ–≤—ã ArchLens MCP
2. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –±–æ–ª—å—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤
3. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞**: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –ø–æ—Ä–æ–≥–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
4. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è CI/CD**: Hooks –¥–ª—è GitHub Actions

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è hooks –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–∫–∞–º–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –æ—Ç–ª–∞–¥–∫–∏.

Hooks –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏ –∞–¥–∞–ø—Ç–∏—Ä—É—é—Ç –∞–Ω–∞–ª–∏–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ.