Руководство для ассистента (Codex CLI)

Назначение
- Единый набор правил и быстрых практик для выполнения задач в этом репозитории максимально быстро и безопасно.
- Ассистент учитывает этот файл по умолчанию в рамках сессий Codex CLI.

Приоритеты (в порядке убывания)
- Корректность и предсказуемость поведения.
- Минимальный дифф и сохранение текущей архитектуры/стиля.
- Быстрая обратная связь (короткие итерации, ранние черновики, воспроизводимость).
- Производительность, безопасность и эксплуатационная готовность.

Язык и тон
- Русский, кратко и по делу. Развёрнутые объяснения — по запросу.

Быстрый старт (заполните конкретику под проект)
- Установка зависимостей: <команда>
- Запуск dev/локально: <команда>
- Тесты: <команда>
- Линтер/форматтер: <команда>
- Тайпчекер (если есть): <команда>
- Запуск всего набора проверок: <команда>
- Переменные окружения/секреты: <описание>

Рабочий цикл задачи (ускоренный)
1) Репродукция/валидция запроса
   - Воспроизвести проблему/запуск по «Быстрому старту». Зафиксировать базовый результат (логи/скрин/тест).
   - Если не удаётся запустить — минимально диагностировать и запросить недостающие данные.
2) План (5–10 строк)
   - Выделить затронутые файлы/модули, риски, вариант тестового покрытия, критерии готовности.
3) Правка (минимальный дифф)
   - Править только необходимое. Сохранять стиль проекта. Не вводить новые зависимости без необходимости.
4) Проверки
   - Локальные тесты и линтеры на изменённых файлах/модулях. Если есть pre-commit — запускать на изменённых файлах.
5) Результат
   - Короткое резюме: что изменено, почему, где. Ссылки на тикет/строки кода при необходимости.

Качество и «ворота» (quality gates)
- Все изменённые строки проходят форматирование/линтеры проекта.
- Тесты зелёные. Для багфикса — добавить тест, воспроизводящий дефект; для фичи — happy-path тест.
- Обратная совместимость сохранена, если не оговорено обратное.
- Документация/README обновлены при влиянии на поведение пользователя/операции.

Ограничения и осторожность
- Публичные API и форматы данных — менять только с явным обоснованием и миграцией.
- Не переписывать значимые части без веской причины; предложить план поэтапного рефакторинга отдельно.
- Сложные/хрупкие зоны: <перечислите модули/папки, например core/, migrations/, billing/>.

Коммиты и PR
- Коммиты маленькие и атомарные, императив: "Fix…", "Add…", "Refactor…".
- PR-описание: проблема → решение → альтернативы (кратко) → тесты → влияние на совместимость/перф/безопасность.
- Ссылки на задачи/обсуждения.

Definition of Ready (DoR)
- Есть воспроизводимая постановка или чёткие критерии приёма.
- Понятно, где в коде менять и какие проверки нужны.

Definition of Done (DoD)
- Реализовано/исправлено по критериям приёма, тесты/линтеры зелёные на изменениях.
- Обновлена документация при изменении поведения.
- Нет лишних комментариев, мёртвого кода, отладочных принтов.

Техническая база и команды (указать применимые)
- Python
  - Установка: pip install -r requirements.txt или poetry install
  - Тесты: pytest -q [путь/к/пакету или -k expr]
  - Линтеры: ruff .; black --check .; isort --check .; mypy .
  - Pre-commit: pre-commit run --files <изменённые_файлы>
- Node.js/TypeScript
  - Установка: pnpm i | npm ci | yarn install
  - Тесты: pnpm test | npm test | yarn test (jest/vitest)
  - Линтеры: eslint .; prettier -c .; tsc -p tsconfig.json --noEmit
- Go
  - Тесты: go test ./...
  - Линтер: golangci-lint run
- Rust
  - Тесты: cargo test
  - Линтеры: cargo clippy -D warnings; cargo fmt -- --check
- .NET
  - Тесты: dotnet test
  - Форматтер/анализ: dotnet format; анализаторы Roslyn
- Terraform/Infra
  - fmt/validate: terraform fmt -check; terraform validate
  - Линтеры/безопасность: tflint; tfsec

Производительность и безопасность
- Производительность: избегать N+1, читать/писать батчами, профилировать горячие участки по необходимости.
- Безопасность: не логировать секреты, валидировать входные данные, следить за зависимостями (audit/npm audit/pip-audit).
- Завистимости: избегать непинованных major-версий, обоснование для новых пакетов.

Совместимость и миграции
- При изменении схем/контрактов: миграционный путь, фича-флаги, обратная совместимость в пределах минорных релизов.

Работа с тестами
- Для багфикса — регресс-тест до исправления (красный), затем сделать зелёным.
- Для фич — минимум один тест happy-path и один негативный.
- Запуск только затронутых тестов для быстроты (по пути/по ключу -k).

Диагностика и логи
- Собирать минимальные артефакты: логи запуска, версии зависимостей, шаги воспроизведения.
- При падениях линтеров/хуков — выводить точный лог и команду воспроизведения.

Поведение ассистента
- Читать код и историю (git blame/log) перед серьёзными правками.
- Сохранять минимальный дифф и стиль проекта.
- Если есть .pre-commit-config.yaml — запускать pre-commit на изменённых файлах; при поломке хуков: сообщить, не чинить вне затронутых строк.
- В ответах писать краткое резюме изменений и команды проверок.

Шаблоны
- Commit message: "fix: описание", "feat: описание", "refactor: …", "test: …", "docs: …"
- PR чек-лист:
  - [ ] Проблема и решение описаны
  - [ ] Покрыто тестами
  - [ ] Линтеры/тайпчекеры зелёные
  - [ ] Нет breaking changes или описана миграция
  - [ ] Обновлена документация (если нужно)

Прошу заполнить раздел «Быстрый старт» и «Сложные/хрупкие зоны» под ваш конкретный стек. После заполнения ассистент будет следовать этим правилам по умолчанию.
