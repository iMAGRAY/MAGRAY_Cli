# Ğ“Ñ€Ğ°Ñ„ ÑĞ²ÑĞ·ĞµĞ¹ Ğ¸ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ²

#architecture #dependencies #graph #relations #obsidian

> **ğŸ”— ĞŸĞ¾Ğ»Ğ½Ğ°Ñ ĞºĞ°Ñ€Ñ‚Ğ° Ğ²Ğ·Ğ°Ğ¸Ğ¼Ğ¾ÑĞ²ÑĞ·ĞµĞ¹ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ² MAGRAY CLI**  
> Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ²ÑĞµÑ… ÑĞ²ÑĞ·ĞµĞ¹, Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹ Ğ¸ Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ² Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¼ĞµĞ¶Ğ´Ñƒ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ°Ğ¼Ğ¸ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹.

## ğŸ¯ ĞĞ±Ğ·Ğ¾Ñ€ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñ‹ ÑĞ²ÑĞ·ĞµĞ¹

### ğŸ“Š Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° ÑĞ²ÑĞ·ĞµĞ¹

| Ğ¢Ğ¸Ğ¿ ÑĞ²ÑĞ·Ğ¸ | ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ | ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ |
|-----------|------------|-------------|--------|
| **Direct Dependencies** | 47 ÑĞ²ÑĞ·ĞµĞ¹ | Ğ’Ñ‹ÑĞ¾ĞºĞ°Ñ | âœ… Mapped |
| **Data Flow** | 23 Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ° | ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ | âœ… Verified |
| **Event Triggers** | 15 ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ | Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ | âœ… Documented |
| **Health Checks** | 12 Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¾Ğº | Ğ’Ñ‹ÑĞ¾ĞºĞ°Ñ | âœ… Active |

## ğŸ—ï¸ Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ½Ğ°Ñ Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ°

```mermaid
graph TB
    subgraph "ğŸ–¥ï¸ Frontend Layer"
        CLI[CLI Crate<br/>ğŸ¯ Entry Point]
        Progress[Adaptive Progress<br/>ğŸ¨ UI Feedback]
        Health[Health Checks<br/>ğŸ¥ System Status]
    end
    
    subgraph "ğŸ¤– Orchestration Layer"
        Agent[Unified Agent<br/>ğŸ­ Core Orchestrator]
        Router[Smart Router<br/>ğŸ”€ Task Routing]
        Planner[Action Planner<br/>ğŸ“‹ Task Planning]
    end
    
    subgraph "ğŸ§  Core Services"
        Memory[Memory Service<br/>ğŸ’¾ Vector Storage]
        AI[AI Service<br/>ğŸš€ ONNX Models]
        LLM[LLM Client<br/>ğŸ¤– Multi-Provider]
        Tools[Tool Registry<br/>ğŸ› ï¸ Safe Execution]
    end
    
    subgraph "ğŸ”§ Infrastructure"
        Common[Common Utils<br/>âš™ï¸ Foundation]
        Database[Database Manager<br/>ğŸ—„ï¸ Sled Backend]
        Cache[Cache System<br/>âš¡ LRU + Persistence]
        Notifications[Alert System<br/>ğŸ“¢ Production Alerts]
    end
    
    subgraph "ğŸ® Hardware Layer"
        GPU[GPU Manager<br/>âš¡ CUDA Acceleration]
        MemPool[Memory Pool<br/>ğŸ’¾ VRAM Management]
        Fallback[Fallback Manager<br/>ğŸ”„ CPU Fallback]
    end
    
    %% Main flow connections
    CLI --> Agent
    Agent --> Router
    Router --> Memory
    Router --> AI
    Router --> LLM
    Router --> Tools
    
    %% Core service interconnections
    Memory --> AI
    Memory --> Database
    Memory --> Cache
    AI --> GPU
    AI --> MemPool
    GPU --> Fallback
    
    %% Infrastructure connections
    Memory --> Common
    AI --> Common
    LLM --> Common
    Tools --> Common
    Database --> Common
    Cache --> Common
    
    %% Monitoring connections
    CLI --> Health
    Memory --> Notifications
    AI --> Notifications
    GPU --> Notifications
    
    %% UI feedback
    CLI --> Progress
    Memory --> Progress
    AI --> Progress
    
    classDef frontend fill:#e1f5fe
    classDef orchestration fill:#f3e5f5
    classDef services fill:#e8f5e8
    classDef infrastructure fill:#fff3e0
    classDef hardware fill:#ffebee
    
    class CLI,Progress,Health frontend
    class Agent,Router,Planner orchestration
    class Memory,AI,LLM,Tools services
    class Common,Database,Cache,Notifications infrastructure
    class GPU,MemPool,Fallback hardware
```

## ğŸ§  Memory System - Ğ’Ğ½ÑƒÑ‚Ñ€ĞµĞ½Ğ½Ğ¸Ğµ ÑĞ²ÑĞ·Ğ¸

### ğŸ›ï¸ Ğ¢Ñ€Ñ‘Ñ…ÑĞ»Ğ¾Ğ¹Ğ½Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° ÑĞ²ÑĞ·ĞµĞ¹

```mermaid
graph TB
    subgraph "Data Flow Pipeline"
        Input[ğŸ“ Input Data] --> Embed[ğŸ”„ Embedding Service]
        Embed --> VectorStore[ğŸ“Š Vector Store]
        VectorStore --> HNSW[ğŸ” HNSW Index]
        HNSW --> LayerRouter[ğŸ¯ Layer Router]
    end
    
    subgraph "Layer 1: Interact (24h TTL)"
        I_DB[(Interact DB)]
        I_Index[Interact HNSW]
        I_Cache[Interact Cache]
    end
    
    subgraph "Layer 2: Insights (90d TTL)"  
        In_DB[(Insights DB)]
        In_Index[Insights HNSW]
        In_Cache[Insights Cache]
    end
    
    subgraph "Layer 3: Assets (âˆ TTL)"
        A_DB[(Assets DB)]
        A_Index[Assets HNSW]  
        A_Cache[Assets Cache]
    end
    
    subgraph "Promotion System"
        MLEngine[ğŸ¤– ML Promotion Engine]
        TimeTracker[â° Time Tracker]
        AccessTracker[ğŸ“Š Access Tracker]
        Scheduler[âš¡ Promotion Scheduler]
    end
    
    subgraph "Search & Retrieval"
        SearchAPI[ğŸ” Search API]
        Reranker[ğŸ“ˆ BGE Reranker]
        Results[ğŸ“‹ Result Processor]
    end
    
    %% Data flow to layers
    LayerRouter --> I_DB
    LayerRouter --> In_DB  
    LayerRouter --> A_DB
    
    I_DB --> I_Index
    In_DB --> In_Index
    A_DB --> A_Index
    
    I_Index --> I_Cache
    In_Index --> In_Cache
    A_Index --> A_Cache
    
    %% Promotion flows
    I_DB --> MLEngine
    In_DB --> MLEngine
    TimeTracker --> MLEngine
    AccessTracker --> MLEngine
    MLEngine --> Scheduler
    
    Scheduler --> In_DB
    Scheduler --> A_DB
    
    %% Search flows
    SearchAPI --> I_Index
    SearchAPI --> In_Index
    SearchAPI --> A_Index
    
    I_Index --> Reranker
    In_Index --> Reranker
    A_Index --> Reranker
    
    Reranker --> Results
    
    classDef layer1 fill:#e3f2fd
    classDef layer2 fill:#f1f8e9  
    classDef layer3 fill:#fff8e1
    classDef promotion fill:#fce4ec
    classDef search fill:#f3e5f5
    
    class I_DB,I_Index,I_Cache layer1
    class In_DB,In_Index,In_Cache layer2
    class A_DB,A_Index,A_Cache layer3
    class MLEngine,TimeTracker,AccessTracker,Scheduler promotion
    class SearchAPI,Reranker,Results search
```

### ğŸ”— Memory Component Dependencies

| Component | Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ñ‚ Ğ¾Ñ‚ | Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ ÑĞ²ÑĞ·Ğ¸ |
|-----------|------------|------------|--------------|
| **Vector Store** | [[Database Manager]], [[Cache System]] | Sled DB, LRU Cache | âœ… Active |
| **HNSW Index** | [[Vector Store]], hnsw_rs | Raw vectors | âœ… Strong |
| **ML Promotion** | [[Vector Store]], [[Time Tracker]] | Access patterns | âœ… Active |
| **Search API** | [[HNSW Index]], [[BGE Reranker]] | Vector similarity | âœ… Strong |
| **Cache System** | [[Database Manager]] | Persistence layer | âœ… Active |

## ğŸ¤– AI System - ĞœĞ¾Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğµ ÑĞ²ÑĞ·Ğ¸

### ğŸš€ ONNX Pipeline Architecture

```mermaid
graph TB
    subgraph "Model Registry & Loading"
        Registry[ğŸ“‹ Model Registry<br/>Centralized Metadata]
        Downloader[â¬‡ï¸ Model Downloader<br/>Auto-fetch Models]
        Loader[ğŸ“¦ Model Loader<br/>ONNX Loading]
    end
    
    subgraph "Embedding Pipeline"
        TokenizerService[ğŸ”¤ Tokenizer Service<br/>Text â†’ Tokens]
        QwenCPU[ğŸ–¥ï¸ Qwen3 CPU<br/>CPU Inference]
        QwenGPU[ğŸ® Qwen3 GPU<br/>GPU Inference]
        DeviceSelector[ğŸ¯ Auto Device Selector<br/>Intelligent Routing]
    end
    
    subgraph "GPU Management"
        GPUDetector[ğŸ” GPU Detector<br/>Hardware Detection]
        MemoryPool[ğŸ’¾ GPU Memory Pool<br/>VRAM Management]
        PipelineManager[âš¡ Pipeline Manager<br/>Batch Processing]
        FallbackManager[ğŸ”„ Fallback Manager<br/>CPU Fallback]
        TensorRTCache[âš¡ TensorRT Cache<br/>Optimized Models]
    end
    
    subgraph "Reranking System"
        BGEReranker[ğŸ“Š BGE Reranker v2-m3<br/>Semantic Reranking]
        OptimizedReranker[âš¡ Optimized Reranker<br/>Fast Inference]
    end
    
    %% Registry connections
    Registry --> Downloader
    Downloader --> Loader
    Loader --> QwenCPU
    Loader --> QwenGPU
    
    %% Embedding pipeline
    TokenizerService --> QwenCPU
    TokenizerService --> QwenGPU
    DeviceSelector --> QwenCPU
    DeviceSelector --> QwenGPU
    
    %% GPU management
    GPUDetector --> DeviceSelector
    GPUDetector --> MemoryPool
    MemoryPool --> PipelineManager
    PipelineManager --> QwenGPU
    FallbackManager --> QwenCPU
    QwenGPU --> FallbackManager
    TensorRTCache --> QwenGPU
    
    %% Reranking connections
    QwenCPU --> BGEReranker
    QwenGPU --> BGEReranker
    BGEReranker --> OptimizedReranker
    
    classDef registry fill:#e8f5e8
    classDef embedding fill:#e1f5fe
    classDef gpu fill:#ffebee
    classDef reranking fill:#f3e5f5
    
    class Registry,Downloader,Loader registry
    class TokenizerService,QwenCPU,QwenGPU,DeviceSelector embedding
    class GPUDetector,MemoryPool,PipelineManager,FallbackManager,TensorRTCache gpu
    class BGEReranker,OptimizedReranker reranking
```

### ğŸ® GPU Dependency Chain

```mermaid
graph LR
    subgraph "Detection Phase"
        A[GPU Detector] --> B[Hardware Info]
        B --> C[Capability Check]
    end
    
    subgraph "Initialization Phase"
        C --> D[Memory Pool Init]
        D --> E[Pipeline Setup]
        E --> F[TensorRT Cache]
    end
    
    subgraph "Runtime Phase"
        F --> G[Batch Processor]
        G --> H[Fallback Check]
        H --> I[CPU Fallback]
        H --> J[GPU Execution]
    end
    
    subgraph "Monitoring Phase"
        J --> K[Performance Monitor]
        I --> K
        K --> L[Health Updates]
    end
    
    classDef detection fill:#e3f2fd
    classDef init fill:#f1f8e9
    classDef runtime fill:#fff8e1
    classDef monitoring fill:#fce4ec
    
    class A,B,C detection
    class D,E,F init
    class G,H,I,J runtime
    class K,L monitoring
```

## ğŸ–¥ï¸ CLI System - Command Flow

### ğŸ¯ Command Processing Pipeline

```mermaid
graph TB
    subgraph "Input Layer"
        UserInput[ğŸ‘¤ User Input] --> Parser[ğŸ“‹ Clap Parser]
        Parser --> CommandRouter[ğŸ”€ Command Router]
    end
    
    subgraph "Command Handlers"
        ChatCmd[ğŸ’¬ Chat Command]
        SmartCmd[ğŸ§  Smart Command]
        ToolCmd[ğŸ› ï¸ Tool Command]
        StatusCmd[ğŸ“Š Status Command]
        HealthCmd[ğŸ¥ Health Command]
        GPUCmd[ğŸ® GPU Command]
        MemoryCmd[ğŸ’¾ Memory Command]
        ModelsCmd[ğŸ“¦ Models Command]
    end
    
    subgraph "Agent Layer"
        UnifiedAgent[ğŸ­ Unified Agent<br/>Core Orchestrator]
        ActionPlanner[ğŸ“‹ Action Planner]
        IntentAnalyzer[ğŸ” Intent Analyzer]
        ParameterExtractor[âš™ï¸ Parameter Extractor]
        ToolSelector[ğŸ¯ Tool Selector]
    end
    
    subgraph "Execution Layer"
        MemoryService[ğŸ§  Memory Operations]
        AIService[ğŸ¤– AI Operations]
        LLMService[ğŸ’­ LLM Operations]
        ToolExecution[âš¡ Tool Execution]
        SystemOps[ğŸ”§ System Operations]
    end
    
    subgraph "Response Layer"
        ProgressBar[ğŸ“Š Progress Indicators]
        ResultFormatter[âœ¨ Result Formatting]
        ErrorHandler[âŒ Error Handling]
    end
    
    %% Input processing
    CommandRouter --> ChatCmd
    CommandRouter --> SmartCmd
    CommandRouter --> ToolCmd
    CommandRouter --> StatusCmd
    CommandRouter --> HealthCmd
    CommandRouter --> GPUCmd
    CommandRouter --> MemoryCmd
    CommandRouter --> ModelsCmd
    
    %% Agent integration
    ChatCmd --> UnifiedAgent
    SmartCmd --> UnifiedAgent
    ToolCmd --> UnifiedAgent
    
    %% Agent internal flow
    UnifiedAgent --> ActionPlanner
    ActionPlanner --> IntentAnalyzer
    IntentAnalyzer --> ParameterExtractor
    ParameterExtractor --> ToolSelector
    
    %% Execution routing
    ToolSelector --> MemoryService
    ToolSelector --> AIService
    ToolSelector --> LLMService
    ToolSelector --> ToolExecution
    
    StatusCmd --> SystemOps
    HealthCmd --> SystemOps
    GPUCmd --> SystemOps
    MemoryCmd --> MemoryService
    ModelsCmd --> AIService
    
    %% Response handling
    MemoryService --> ProgressBar
    AIService --> ProgressBar
    LLMService --> ProgressBar
    ToolExecution --> ProgressBar
    SystemOps --> ProgressBar
    
    ProgressBar --> ResultFormatter
    ResultFormatter --> ErrorHandler
    
    classDef input fill:#e3f2fd
    classDef commands fill:#f1f8e9
    classDef agent fill:#fff8e1
    classDef execution fill:#fce4ec
    classDef response fill:#f3e5f5
    
    class UserInput,Parser,CommandRouter input
    class ChatCmd,SmartCmd,ToolCmd,StatusCmd,HealthCmd,GPUCmd,MemoryCmd,ModelsCmd commands
    class UnifiedAgent,ActionPlanner,IntentAnalyzer,ParameterExtractor,ToolSelector agent
    class MemoryService,AIService,LLMService,ToolExecution,SystemOps execution
    class ProgressBar,ResultFormatter,ErrorHandler response
```

## ğŸ”„ Data Flow Analysis

### ğŸ“Š Main Data Flows

```mermaid
sequenceDiagram
    participant U as User
    participant C as CLI
    participant A as Agent
    participant M as Memory
    participant AI as AI Service
    participant GPU as GPU Manager
    
    U->>C: magray smart "analyze code"
    C->>A: Parse and route command
    A->>A: Analyze intent & plan actions
    A->>M: Search for relevant context
    M->>AI: Request embeddings
    AI->>GPU: Check GPU availability
    GPU-->>AI: GPU ready / fallback to CPU
    AI-->>M: Return embeddings
    M-->>A: Return search results
    A->>AI: Generate response with context
    AI-->>A: Return enhanced response
    A-->>C: Formatted response
    C-->>U: Display result with progress
    
    Note over M: Background: ML promotion runs
    M->>M: Promote important data to Insights
    
    Note over AI: Background: Cache management
    AI->>AI: Cache embeddings for reuse
```

### ğŸ”— Component Interaction Matrix

| Component | Memory | AI | LLM | Tools | Router | CLI | Common |
|-----------|--------|----|----|-------|--------|-----|--------|
| **Memory** | - | âœ… Strong | âŒ None | âŒ None | âœ… Medium | âœ… Direct | âœ… Foundation |
| **AI** | âœ… Strong | - | âŒ None | âŒ None | âœ… Medium | âœ… Direct | âœ… Foundation |
| **LLM** | âŒ None | âŒ None | - | âŒ None | âœ… Strong | âœ… Direct | âœ… Foundation |
| **Tools** | âŒ None | âŒ None | âŒ None | - | âœ… Strong | âœ… Direct | âœ… Foundation |
| **Router** | âœ… Medium | âœ… Medium | âœ… Strong | âœ… Strong | - | âœ… Direct | âœ… Foundation |
| **CLI** | âœ… Direct | âœ… Direct | âœ… Direct | âœ… Direct | âœ… Direct | - | âœ… Foundation |

**Legend:**
- âœ… **Strong**: Tight coupling, direct API calls
- âœ… **Medium**: Moderate coupling, occasional interaction
- âœ… **Direct**: Command-level integration
- âœ… **Foundation**: Infrastructure dependency
- âŒ **None**: No direct interaction

## ğŸ¥ Health Monitoring Network

### ğŸ“Š Health Check Flow

```mermaid
graph TB
    subgraph "Health Collectors"
        VectorHealth[ğŸ“Š Vector Store Health]
        CacheHealth[âš¡ Cache Health] 
        GPUHealth[ğŸ® GPU Health]
        AIHealth[ğŸ¤– AI Model Health]
        DatabaseHealth[ğŸ—„ï¸ Database Health]
    end
    
    subgraph "Health Aggregation"
        HealthMonitor[ğŸ¥ Health Monitor<br/>Central Collector]
        MetricsCollector[ğŸ“ˆ Metrics Collector<br/>Time Series Data]
        AlertManager[ğŸš¨ Alert Manager<br/>Threshold Monitoring]
    end
    
    subgraph "Notification System"
        Notifications[ğŸ“¢ Notification System<br/>Alert Distribution]
        StatusDisplay[ğŸ“Š Status Display<br/>CLI Output]
        HealthEndpoint[ğŸŒ Health Endpoint<br/>HTTP Check]
    end
    
    %% Collection flows
    VectorHealth --> HealthMonitor
    CacheHealth --> HealthMonitor
    GPUHealth --> HealthMonitor
    AIHealth --> HealthMonitor
    DatabaseHealth --> HealthMonitor
    
    %% Aggregation flows
    HealthMonitor --> MetricsCollector
    HealthMonitor --> AlertManager
    MetricsCollector --> AlertManager
    
    %% Notification flows
    AlertManager --> Notifications
    HealthMonitor --> StatusDisplay
    HealthMonitor --> HealthEndpoint
    
    classDef collectors fill:#e8f5e8
    classDef aggregation fill:#e1f5fe
    classDef notifications fill:#fff3e0
    
    class VectorHealth,CacheHealth,GPUHealth,AIHealth,DatabaseHealth collectors
    class HealthMonitor,MetricsCollector,AlertManager aggregation
    class Notifications,StatusDisplay,HealthEndpoint notifications
```

### ğŸ¯ Health Check Dependencies

| Health Component | Monitors | Dependencies | Update Frequency |
|------------------|----------|--------------|------------------|
| **Vector Store Health** | HNSW performance, search latency | Vector Index, Database | 30s |
| **GPU Health** | VRAM usage, temperature, errors | GPU Detector, Memory Pool | 15s |
| **Cache Health** | Hit rate, memory usage, evictions | LRU Cache, Database | 60s |
| **AI Model Health** | Inference time, error rate, throughput | ONNX Runtime, GPU | 30s |
| **Database Health** | Connection, disk space, query time | Sled DB | 60s |

## ğŸ› ï¸ Development & Build Dependencies

### ğŸ“¦ Build Dependency Graph

```mermaid
graph TB
    subgraph "External Dependencies"
        Tokio[tokio - Async Runtime]
        Sled[sled - Database]
        ONNX[ort - ONNX Runtime]
        HNSW[hnsw_rs - Vector Index]
        Clap[clap - CLI Parsing]
        Anyhow[anyhow - Error Handling]
    end
    
    subgraph "Workspace Crates"
        Common[common - Foundation]
        Memory[memory - Vector Storage]
        AI[ai - ONNX Models]
        LLM[llm - Multi-provider]
        Tools[tools - Safe Execution]
        Router[router - Smart Routing]
        Todo[todo - Task System]
        CLI[cli - User Interface]
    end
    
    %% External dependencies
    Memory --> Sled
    Memory --> HNSW
    AI --> ONNX
    CLI --> Clap
    
    %% Workspace dependencies
    Memory --> Common
    AI --> Common
    LLM --> Common
    Tools --> Common
    Router --> Common
    Todo --> Common
    CLI --> Common
    
    CLI --> Memory
    CLI --> AI
    CLI --> LLM
    CLI --> Tools
    CLI --> Router
    CLI --> Todo
    
    Router --> Memory
    Router --> LLM
    Router --> Tools
    
    Memory --> AI
    
    %% Async runtime
    Memory --> Tokio
    AI --> Tokio
    LLM --> Tokio
    Tools --> Tokio
    Router --> Tokio
    CLI --> Tokio
    
    %% Error handling
    Memory --> Anyhow
    AI --> Anyhow
    LLM --> Anyhow
    Tools --> Anyhow
    Router --> Anyhow
    CLI --> Anyhow
    Common --> Anyhow
    
    classDef external fill:#ffebee
    classDef workspace fill:#e8f5e8
    
    class Tokio,Sled,ONNX,HNSW,Clap,Anyhow external
    class Common,Memory,AI,LLM,Tools,Router,Todo,CLI workspace
```

## ğŸ” Critical Path Analysis

### âš¡ Performance Critical Paths

**Path 1: Search Query Processing**
```
User Input â†’ CLI â†’ Agent â†’ Memory â†’ HNSW Index â†’ Results
Latency: <5ms target, <1ms goal
```

**Path 2: Embedding Generation**  
```
Text Input â†’ AI â†’ GPU/CPU â†’ ONNX Model â†’ Vector â†’ Cache
Latency: <50ms CPU, <15ms GPU
```

**Path 3: Memory Promotion**
```
Background â†’ ML Engine â†’ Time Analysis â†’ Layer Transfer â†’ Index Update
Frequency: Every 10 minutes
```

### ğŸš¨ Failure Points & Fallbacks

| Critical Component | Failure Mode | Fallback Strategy | Recovery Time |
|-------------------|--------------|-------------------|---------------|
| **GPU Processing** | VRAM exhaustion | CPU fallback | <100ms |
| **Vector Index** | Index corruption | Rebuild from DB | 1-5 minutes |
| **Database** | Connection loss | Retry with backoff | <30s |
| **Cache System** | Memory pressure | LRU eviction | Immediate |
| **ONNX Runtime** | Model load fail | Alternative model | <10s |

## ğŸ“Š Component Status Dashboard

### ğŸ¯ Ready for Production

| Component | Status | Test Coverage | Documentation | Production Score |
|-----------|--------|---------------|---------------|------------------|
| **[[HNSW Vector Index]]** | âœ… Ready | 90% | 85% | 95% |
| **[[GPU Batch Processor]]** | âœ… Ready | 80% | 80% | 90% |
| **[[ML Promotion Engine]]** | âœ… Ready | 85% | 75% | 85% |
| **[[Adaptive Progress]]** | âœ… Ready | 95% | 90% | 95% |
| **[[Health Monitor]]** | âœ… Ready | 70% | 80% | 80% |
| **[[Streaming API]]** | âœ… Ready | 75% | 70% | 75% |

### ğŸ”„ In Development

| Component | Status | Implementation | ETA | Priority |
|-----------|--------|----------------|-----|----------|
| **[[DI Container]]** | ğŸš§ Planned | 0% | Q2 2025 | Medium |
| **[[Orchestration System]]** | ğŸš§ Planned | 0% | Q2 2025 | High |
| **[[Error Monitor]]** | ğŸš§ Planned | 0% | Q1 2025 | High |
| **[[Resource Controller]]** | ğŸš§ Planned | 0% | Q2 2025 | Medium |

### âŒ Missing but Planned

| Component | Reason | Impact | Workaround |
|-----------|--------|--------|------------|
| **Migration System** | Not prioritized | Medium | Manual DB updates |
| **Advanced Monitoring** | Basic version sufficient | Low | Current health checks |
| **Kubernetes Integration** | Single-binary focus | Low | Docker containers |
| **Multi-tenant Support** | Not required yet | None | Single-user focus |

## ğŸ”— Navigation Links

### ğŸ“š Detailed Component Documentation
- [[Memory Crate - Ğ¢Ñ€Ñ‘Ñ…ÑĞ»Ğ¾Ğ¹Ğ½Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸]] - Memory system details
- [[AI Crate - Embedding Ğ¸ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸]] - AI/ML pipeline  
- [[CLI Crate - ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¸Ğ¹ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ]] - Command interface (TODO)
- [[LLM Crate - Ğ¯Ğ·Ñ‹ĞºĞ¾Ğ²Ñ‹Ğµ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸]] - Language model integration (TODO)

### ğŸ¯ Architectural Views
- [[ĞŸĞ¾Ğ»Ğ½Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ½Ğ°Ñ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ MAGRAY CLI]] - Complete architecture
- [[Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ²]] - Component status matrix
- [[Roadmap Ñ€Ğ°Ğ·Ğ²Ğ¸Ñ‚Ğ¸Ñ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°]] - Development roadmap

### ğŸ› ï¸ Technical Guides
- [[Ğ ÑƒĞºĞ¾Ğ²Ğ¾Ğ´ÑÑ‚Ğ²Ğ¾ Ğ¿Ğ¾ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞµ Ğ¸ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ]] - Installation guide
- [[Performance Optimization Guide]] - Performance tuning (TODO)
- [[Troubleshooting Guide]] - Problem resolution (TODO)

---

*Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¾: 05.08.2025*  
*ĞÑĞ½Ğ¾Ğ²Ğ°Ğ½Ğ¾ Ğ½Ğ° Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ¼ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğµ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñ‹ MAGRAY CLI*  
*Ğ’ÑĞµ ÑĞ²ÑĞ·Ğ¸ Ğ¸ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞµĞ½Ñ‹ Ğ² ĞºĞ¾Ğ´Ğµ*