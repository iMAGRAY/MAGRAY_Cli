---
description: "Memory & Semantic Router: 5 слоёв памяти и правила промоушена"
globs: []
alwaysApply: false
---

## Слои памяти
- **M0 Ephemeral** — RAM, временные данные шага.
- **M1 ShortTerm** — sqlite KV, последние факты/ответы.
- **M2 MediumTerm** — структурированные записи (таблицы).
- **M3 LongTerm** — большие файлы/артефакты (blobs).
- **M4 Semantic** — векторный индекс (BGE3) со ссылками на все слои.

## Правила
- Любая запись M1–M3 индексируется в M4 (embed + meta link).
- Поиск всегда стартует в M4 → Rerank (BG3) → MemRef → вытаскиваем оригинал.
- Промоушен данных (M0→M1→M2/M3) — по TTL и полезности.
- Очистка/вакуум: удаляй сиротские векторы, архивируй старые blobs.

## При работе агента
- Перед генерацией промпта делай retrieval через M4.
- После получения результата — сохраняй в соответствующий слой и индексируй.
