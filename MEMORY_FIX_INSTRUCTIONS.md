# Claude Code CLI Memory Fix - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é

## üö® –ü–†–û–ë–õ–ï–ú–ê: JavaScript heap out of memory

**–û—à–∏–±–∫–∞**: `FATAL ERROR: Reached heap limit Allocation failed - JavaScript heap out of memory`

## ‚úÖ –†–ï–®–ï–ù–ò–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù–û

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
1. **`scripts/fix_node_memory.ps1`** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
2. **`scripts/cleanup_agent_coordination.ps1`** - –û—á–∏—Å—Ç–∫–∞ –∂—É—Ä–Ω–∞–ª–æ–≤ –∞–≥–µ–Ω—Ç–æ–≤  
3. **`docs/MEMORY_TROUBLESHOOTING.md`** - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é

## üöÄ –ù–ï–ú–ï–î–õ–ï–ù–ù–û–ï –ü–†–ò–ú–ï–ù–ï–ù–ò–ï

### 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
```powershell
cd "C:\Users\1\Documents\GitHub\MAGRAY_Cli"
.\scripts\fix_node_memory.ps1
```

### 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Ä–º–∏–Ω–∞–ª –∏–ª–∏ Claude Code CLI

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫:
```powershell
echo $env:NODE_OPTIONS
# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å: --max-old-space-size=16384 --expose-gc --trace-warnings
```

## üßπ –ü–†–û–§–ò–õ–ê–ö–¢–ò–ß–ï–°–ö–ê–Ø –û–ß–ò–°–¢–ö–ê

### –†–µ–≥—É–ª—è—Ä–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∂—É—Ä–Ω–∞–ª–æ–≤:
```powershell
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –±—É–¥–µ—Ç –æ—á–∏—â–µ–Ω–æ (dry-run)
.\scripts\cleanup_agent_coordination.ps1 -DryRun

# –í—ã–ø–æ–ª–Ω–∏—Ç—å –æ—á–∏—Å—Ç–∫—É
.\scripts\cleanup_agent_coordination.ps1
```

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

**‚úÖ –£–°–ü–ï–®–ù–û –†–ï–ê–õ–ò–ó–û–í–ê–ù–û:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ heap (16GB –¥–ª—è —Å–∏—Å—Ç–µ–º—ã —Å 128GB RAM)
- NODE_OPTIONS –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã: `--max-old-space-size=16384 --expose-gc --trace-warnings`
- –°–∫—Ä–∏–ø—Ç—ã –æ—á–∏—Å—Ç–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞

**‚úÖ PREVENTION –ú–ï–†–û–ü–†–ò–Ø–¢–ò–Ø:**
- –†–æ—Ç–∞—Ü–∏—è agent-coordination.json –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ 200 —Å—Ç—Ä–æ–∫
- –û—á–∏—Å—Ç–∫–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö file locks
- –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö completed tasks (>24 —á–∞—Å–∞)
- EventBus —Å–æ–±—ã—Ç–∏—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã 50 –ø–æ—Å–ª–µ–¥–Ω–∏–º–∏

## üéØ –ö–õ–Æ–ß–ï–í–´–ï –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê

1. **–£–≤–µ–ª–∏—á–µ–Ω heap limit** —Å 4GB –¥–æ 16GB
2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞** –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–∞–º—è—Ç–∏** —á–µ—Ä–µ–∑ --expose-gc
4. **Emergency procedures** –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–ª—É—á–∞–µ–≤
5. **Comprehensive documentation** –¥–ª—è troubleshooting

## ‚ö° EMERGENCY MODE

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç—Å—è:
```powershell
# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π heap (24GB)  
$env:NODE_OPTIONS = "--max-old-space-size=24576 --expose-gc"

# –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
Remove-Item "C:\Users\1\.claude\agents\shared-journal\*" -Force

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Claude Code CLI
```

## üìà –ú–û–ù–ò–¢–û–†–ò–ù–ì

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏:
```powershell
# –í Node.js REPL
global.gc()  # –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞ –º—É—Å–æ—Ä–∞
process.memoryUsage()  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏
```

### –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –ø—Ä–æ–±–ª–µ–º:
- Heap usage >75% –æ—Ç –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–≥–æ
- GC frequency >20/–º–∏–Ω—É—Ç–∞
- Agent coordination file >200 —Å—Ç—Ä–æ–∫
- Events –≤ –ø–∞–º—è—Ç–∏ >1000

---

## ‚úÖ SUCCESS CRITERIA - –î–û–°–¢–ò–ì–ù–£–¢–´

- [x] **–ü—Ä–∏—á–∏–Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞**: –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ heap limit 4GB
- [x] **–†–µ—à–µ–Ω–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–æ**: –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –¥–æ 16GB + –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞  
- [x] **Claude Code CLI —Å—Ç–∞–±–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç**: NODE_OPTIONS –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [x] **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞**: –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ troubleshooting
- [x] **Automation —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞**: –°–∫—Ä–∏–ø—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- [x] **Prevention –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è**: –†–µ–≥—É–ª—è—Ä–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

---

**üéâ Claude Code CLI Memory Issue - –†–ï–®–ï–ù–ê**

*–°–æ–∑–¥–∞–Ω–æ: 2025-08-13*  
*–°—Ç–∞—Ç—É—Å: Production Ready*  
*–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: –£—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–æ*